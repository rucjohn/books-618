# 永不消失的网站

基于网站的重要性，马松总提出“永不消失的网站”，网站有任何一个细小的问题，都会影响用户的购物体验，为此我们从设计原则到高性能、高吞吐量、高可用的系统设计，到高灵敏的监控系统构思，再到应急方案的制订钻研了一套体系，本节将从网站首页、商品详情页、分类列表页、网站监控工具四个相关系统做详细讲解。

## 首页优化之路

京东首页是京东网站的门户，承载了所有重要的业务入口，流量很大，具有不言而喻的战略地位。

在浏览器里输出`www.jd.com`，进入京东京东首页，给用户呈现的是一个拥有各种各样商品和促销导购活动的缤纷页面，在这个页面的背后其实承载了一条艰辛的京东首页优化之路。

### 1. 整体架构

京东首页的整体架构示意如图2-1所示。

从图2-1中可以看出，京东首页主要分为三层：前端展示层、中间逻辑层、底层数据层，其中前端展示层负载页面展示；中间逻辑容灾层则保证前端展示数据的实时性；而底层数据层作为最后一道关卡，负责整体数据的存储。

另外，CMS后台和容灾后台作为后台系统对上面三层在容灾方面做有力的补充，一起保障了首页的稳定。

下面就京东首页三层做具体的介绍。

### 2. 前端展示层

随着业务发展，前端展示层主要经历了：静态、伪静态、动态三个阶段。表2-1对比了各个阶段的优缺点。

表 2-1    首页前端展示层的演变过程

| 阶段 | 优点 | 缺点 |
| --- | --- | --- |
| 静态 | 静态页面维护简单，节省资源，四台 16U 的服务器配合 CDN 好可以支撑 618 峰值 |  首页各模块间存在强依赖，一个模块出现问题，会影响其他页面；同时在保证 CND 的命中率方面，往往会设置比较长的 CDN 缓存时间，但已经无法跟上 618 业务量的提升步伐 |
| 伪静态 | 为首页各模块解耦，提高页面维护效率，结合 SSI 技术，在拼装静态页面的过程做动态业务逻辑，比如获取客户端 Cookie 展示简单个性化数据 | 个性化数据出现问题，无法满足千人千面的要求，势必做出改变 |
| 动态 | 随着 BI 的发展，个性化需求也越来越强烈，在保证首屏加载速度的同时实现千人千面，首屏同步渲染，保证首屏的加载速度；个性化数据应用层灾备，保证首页数据的完整性 | 易受第三方接口影响 |

### 3. 中间逻辑层
